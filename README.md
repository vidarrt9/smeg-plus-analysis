The interesting parts from the SMEG+ upgrade package.
